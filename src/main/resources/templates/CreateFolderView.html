<!DOCTYPE html>
<html lang="en"
      layout:decorate="~{Layout}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Create folder</title>
</head>

<section layout:fragment="content">
    <main class="editor-page">
        <div class="container">
            <section class="card editor-card-wide">
                <!-- HEADER -->
                <div class="form-header">
                    <h1 class="form-title">Create a new folder</h1>
                    <p class="form-subtitle">
                        Create a subfolder inside
                        <span th:text="${folder.name}">Current folder</span>.
                    </p>
                </div>

                <div class="folder-layout">
                    <!-- LEFT: folder info + tree -->
                    <aside class="card folder-sidebar">
                        <!-- Folder details -->
                        <div class="folder-sidebar-section">
                            <div class="card-title">Folder details</div>
                            <div class="card-subtitle">
                                You are creating a folder under this location.
                            </div>

                            <div class="folder-stats">
                                <div class="folder-stat-item" th:if="${folder.folderCount > 0}">
                                    <span class="folder-stat-label">Subfolders</span>
                                    <span class="folder-stat-value" th:text="${folder.folderCount}">0</span>
                                </div>
                                <div class="folder-stat-item">
                                    <span class="folder-stat-label">Posts</span>
                                    <span class="folder-stat-value" th:text="${folder.postCount}">0</span>
                                </div>
                            </div>
                        </div>

                        <!-- PARENT FOLDER (one level up) -->
                        <div class="folder-sidebar-section" th:if="${parent != null}">
                            <div class="card-title" style="margin-bottom:0.3rem;">Parent folder</div>

                            <div class="folder-parent">
                                <a class="folder-parent-link"
                                   th:href="@{/folders/new(folderId=${parent.id},
                                          siblingPage=${siblingPage},
                                          childPage=${childPage})}">
                                    <span class="folder-node-icon">‚¨Ö</span>
                                    <span class="folder-node-name" th:text="${parent.name}">Parent folder</span>
                                </a>
                                <div class="folder-parent-meta"
                                     th:text="${parent.postCount} + ' topics'">
                                    0 topics
                                </div>
                            </div>
                        </div>

                        <!-- CURRENT FOLDER + SIBLINGS -->
                        <div class="folder-sidebar-section">
                            <div class="card-title" style="margin-bottom:0.3rem;">This level</div>

                            <ul class="folder-tree folder-tree--siblings">
                                <!-- Current folder -->
                                <li class="folder-node folder-node--active">
                                    <a th:href="@{/folders/new(folderId=${folder.id},
                                             siblingPage=${siblingPage},
                                             childPage=${childPage})}">
                                        <span class="folder-node-icon">üìÇ</span>
                                        <span class="folder-node-name"
                                              th:text="${folder.name}">Current folder</span>
                                        <span class="folder-node-count"
                                              th:text="${folder.postCount} + ' topics'">0 topics</span>
                                    </a>
                                </li>

                                <!-- Siblings -->
                                <li class="folder-node" th:each="sibling : ${siblingFolders}">
                                    <a th:href="@{/folders/new(folderId=${sibling.id},
                                             siblingPage=${siblingPage},
                                             childPage=${childPage})}">
                                        <span class="folder-node-icon">üìÇ</span>
                                        <span class="folder-node-name" th:text="${sibling.name}">Sibling</span>
                                        <span class="folder-node-count"
                                              th:text="${sibling.postCount} + ' topics'">0 topics</span>
                                    </a>
                                </li>
                            </ul>

                            <div class="folder-pagination" th:if="${siblingTotalPages > 1}">
                                <button class="btn btn-ghost folder-page-btn sibling-page-btn"
                                        data-delta="-1"
                                        th:disabled="${siblingPage == 1}"
                                        type="button">
                                    ‚Äπ Prev
                                </button>

                                <span class="folder-page-info"
                                      th:text="'Page ' + ${siblingPage} + ' of ' + ${siblingTotalPages}">
                                    Page 1 of 1
                                </span>

                                <button class="btn btn-ghost folder-page-btn sibling-page-btn"
                                        data-delta="1"
                                        th:disabled="${siblingPage == siblingTotalPages}"
                                        type="button">
                                    Next ‚Ä∫
                                </button>
                            </div>
                        </div>

                        <!-- CHILD FOLDERS -->
                        <div class="folder-sidebar-section"
                             th:if="${childFolders != null and !#lists.isEmpty(childFolders)}">
                            <div class="card-title" style="margin-bottom:0.3rem;">Subfolders</div>

                            <ul class="folder-tree folder-tree--children">
                                <li class="folder-node" th:each="child : ${childFolders}">
                                    <a th:href="@{/folders/new(folderId=${child.id},
                                             siblingPage=${siblingPage},
                                             childPage=${childPage})}">
                                        <span class="folder-node-icon">üìÅ</span>
                                        <span class="folder-node-name" th:text="${child.name}">Child</span>
                                        <span class="folder-node-count"
                                              th:text="${child.postCount} + ' topics'">0 topics</span>
                                    </a>
                                </li>
                            </ul>
                        </div>

                        <div class="folder-pagination" th:if="${childTotalPages > 1}">
                            <button class="btn btn-ghost folder-page-btn child-page-btn"
                                    data-delta="-1"
                                    th:disabled="${childPage == 1}"
                                    type="button">
                                ‚Äπ Prev
                            </button>

                            <span class="folder-page-info"
                                  th:text="'Page ' + ${childPage} + ' of ' + ${childTotalPages}">
                                Page 1 of 1
                            </span>

                            <button class="btn btn-ghost folder-page-btn child-page-btn"
                                    data-delta="1"
                                    th:disabled="${childPage == childTotalPages}"
                                    type="button">
                                Next ‚Ä∫
                            </button>
                        </div>
                    </aside>

                    <!-- RIGHT: create folder form -->
                    <section class="card folder-posts">
                        <!-- navigation form: keeps folderId + sibling/child pagination in sync -->
                        <form id="navigation-form" method="get" th:action="@{/folders/new}">
                            <input name="folderId" th:value="${folder.id}" type="hidden">
                            <input name="siblingPage" th:value="${siblingPage}" type="hidden">
                            <input name="childPage" th:value="${childPage}" type="hidden">
                        </form>

                        <form method="post"
                              th:action="@{/folders/new}"
                              th:object="${folderForm}">
                            <div class="form-field">
                                <label class="form-label" for="folder-name">Folder name</label>
                                <input class="form-input"
                                       id="folder-name"
                                       placeholder="e.g. Sci-Fi &amp; Fantasy"
                                       th:field="*{name}"
                                       type="text">
                                <div class="field-error" th:errors="*{name}"></div>
                            </div>

                            <div class="form-field">
                                <label class="form-label" for="folder-slug">Slug</label>
                                <input class="form-input"
                                       id="folder-slug"
                                       placeholder="e.g. sci-fi-fantasy"
                                       th:field="*{slug}"
                                       type="text">
                                <div class="field-error" th:errors="*{slug}"></div>
                                <p class="form-help">
                                    Used in the URL. Lowercase, letters, numbers and dashes only.
                                </p>
                            </div>

                            <div class="form-field">
                                <label class="form-label" for="folder-description">Description
                                    <span>(optional)</span></label>
                                <textarea class="form-textarea form-textarea-wide"
                                          id="folder-description"
                                          placeholder="Describe what belongs in this folder."
                                          th:field="*{description}"></textarea>
                                <div class="field-error" th:errors="*{description}"></div>
                            </div>

                            <!-- parent folder id -->
                            <input th:field="*{parentFolderId}" th:value="${folder.id}" type="hidden"/>

                            <div class="form-actions">
                                <button class="btn btn-primary" type="submit">Create folder</button>
                            </div>
                        </form>
                    </section>
                </div>
            </section>
        </div>
    </main>
</section>

<th:block layout:fragment="scripts">
    <script th:inline="javascript">
        var form = $('#navigation-form');

        // sibling / child pagination for sidebar
        $('.sibling-page-btn').on('click', function () {
            var delta = parseInt($(this).data('delta'));
            var input = $(form).find('input[name=siblingPage]');
            var current = parseInt(input.val() || '1');
            input.val(current + delta);
            form.submit();
        });

        $('.child-page-btn').on('click', function () {
            var delta = parseInt($(this).data('delta'));
            var input = $(form).find('input[name=childPage]');
            var current = parseInt(input.val() || '1');
            input.val(current + delta);
            form.submit();
        });
    </script>
</th:block>
</html>
