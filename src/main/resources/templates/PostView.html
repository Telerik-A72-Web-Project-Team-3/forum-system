<!DOCTYPE html>
<html lang="en"
      layout:decorate="~{Layout}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <title>View post</title>
</head>

<section layout:fragment="content">
    <!-- MAIN CONTENT -->
    <main class="post-page">
        <div class="container">
            <div class="post-layout">
                <!-- MAIN COLUMN -->
                <section class="card post-card">
                    <header class="post-header">
                        <div class="post-label-row">
                            <span class="pill" th:each="tag: ${tags}" th:text="${tag.name}"></span>
                        </div>
                        <h1 class="post-title" th:text="${post.title}"></h1>
                        <div class="post-meta">
                            <span>Started by <strong th:text="${post.creator}"></strong></span>
                            <span>·</span>
                            <span>Posted 2 hours ago (TODO)</span>
                            <span>·</span>
                            <span>
                                <span th:text="${post.commentsCount}"></span>
                                replies ·
                                <span th:text="${post.views}"></span> views
                            </span>
                        </div>
                    </header>

                    <article class="post-body">
                        <p th:text="${post.content}"></p>
                    </article>

                    <div class="post-actions" sec:authorize="isAuthenticated()">
                        <button class="btn btn-primary" type="button">Reply</button>
                        <button class="btn btn-ghost" type="button">Follow thread (TODO?)</button>
                        <button class=" btn btn-ghost" type="button">Like ·
                            <span th:text="${post.likedBy.size()}">24</span></button>
                    </div>
                </section>

                <!-- COMMENTS SECTION -->
                <section class="card comment-section">
                    <header class="card-header">
                        <div>
                            <div class="card-title">Comments</div>
                            <div class="card-subtitle"><span th:text="${post.comments.size()}"></span> replies ·
                                sorted by <span th:if="${sortCommentsBy=='date'}">newest</span>
                                <span th:if="${sortCommentsBy=='likes'}">likes</span></div>
                        </div>
                        <div class="folder-toolbar">
                            <!--                            <div class="folder-toolbar-left">-->
                            <!--                                <span class="card-title">Posts:</span>-->
                            <!--                                <span class="folder-toolbar-meta">Showing 1–10 of 21</span>-->
                            <!--                            </div>-->
                            <div class="folder-toolbar-right">
                                <select class="comment-order-by folder-select"
                                        name="sortCommentsBy"
                                        th:value="${sortCommentsBy}">
                                    <option th:selected="${sortCommentsBy == 'date'}" value="date">Sort by newest
                                    </option>
                                    <option th:selected="${sortCommentsBy == 'likes'}" value="likes">Sort by most
                                        likes
                                    </option>
                                </select>
                            </div>
                        </div>
                    </header>

                    <!-- COMMENT FORM (visible when logged in) -->
                    <div class="comment-form" sec:authorize="isAuthenticated()">
                        <div class="comment-form-header">
                            <span class="comment-form-avatar">M</span>
                            <div class="comment-form-meta">
                                <div class="comment-form-user" sec:authentication="name">You</div>
                                <div class="comment-form-hint">Share your thoughts about this discussion.</div>
                            </div>
                        </div>
                        <form>
                            <textarea
                                    class="comment-input"
                                    name="content"
                                    placeholder="Write a comment..."
                                    rows="4"></textarea>
                            <div class="comment-form-actions">
                                <button class="btn btn-primary" type="submit">Post comment</button>
                                <span class="comment-form-note">Markdown supported. Add spoilers with >!
                                    text, **bold** for emphasis, *italic* for emphasis, [text](url) for links.</span>
                            </div>
                        </form>
                    </div>

                    <!-- COMMENT LIST -->
                    <div class="comment-list">
                        <!-- Comment 1 -->
                        <article class="comment" th:each="comment: ${post.comments}">
                            <header class="comment-header">
                                <div class="comment-avatar">A</div>
                                <div class="comment-header-main">
                                    <div class="comment-author-row">
                                        <span class="comment-author" th:text="${comment.user.username}">ana</span>
                                        <span class="comment-badge comment-badge-mod" th:if="${comment.user.isAdmin()}">
                                            Mod</span>
                                    </div>
                                    <div class="comment-meta">
                                        <span>1 hour ago (TODO)</span>
                                        <span>·</span>
                                        <span>Edited (TODO)</span>
                                    </div>
                                </div>
                            </header>
                            <div class="comment-body" th:text="${comment.content}">
                                <p>
                                    For me, <em>The Last Kingdom</em> wins overall. The pacing is better and
                                    Uhtred has a more consistent arc than anyone in <em>Vikings</em>.
                                </p>
                                <p>
                                    That said, the first 2–3 seasons of <em>Vikings</em> have some of the best
                                    atmosphere and music in any historical show.
                                </p>
                            </div>
                            <footer class="comment-footer">
                                <button class="comment-action" type="button">Reply</button>
                                <button class="comment-action" type="button">Like ·
                                    <span th:text="${comment.likedBy.size()}">24</span></button>
                                <button class="comment-action comment-action-soft" type="button">Report</button>
                            </footer>
                        </article>
                    </div>
                </section>
            </div>
        </div>
    </main>
</section>
<th:block layout:fragment="head">
    <script th:inline="javascript">
        $(function () {
            $('.comment-order-by').on('change', function () {
                console.log('a');
                window.location.search = $.param({sortCommentsBy: $(this).val()});
            });
        });
    </script>
</th:block>
</html>
